// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // أو "sqlite" لو انت عاملها كده
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  USER
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  passwordHash String
  name         String?
  role         UserRole @default(USER)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  sessions Session[]
  tasks    Task[]
}

model Session {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  DONE
  CANCELED
}

model Task {
  id           Int        @id @default(autoincrement())
  title        String
  description  String?
  status       TaskStatus @default(PENDING)
  dueDate      DateTime?
  assignedToId Int?
  assignedTo   User?      @relation(fields: [assignedToId], references: [id])
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Driver {
  id                   String   @id
  name                 String
  canNight             Boolean  @default(false)
  weekAvailability     Json     @default("[]")
  leaves               Json     @default("[]")
  sleepsInCab          Boolean? @default(false)
  doubleMannedEligible Boolean? @default(false)
  photoUrl             String?
}

model Tractor {
  id           Int     @id @default(autoincrement())
  code         String  @default("")
  plate        String  @default("")
  doubleManned Boolean @default(false)

  jobs Job[]
}

model Trailer {
  id   String @id @default(uuid())
  code String @default("")
  type String @default("")

  jobs Job[]
}

model Location {
  id   String @id
  name String
  lat  Float?
  lng  Float?
}

model Job {
  id            String   @id
  date          DateTime
  slot          String   @default("day")
  start         String   @default("08:00")
  durationHours Float    @default(4)
  client        String   @default("")
  pickup        String   @default("")
  dropoff       String   @default("")

  pricingType  String @default("per_km")
  pricingValue Float  @default(0)

  tractorId Int?
  tractor   Tractor? @relation(fields: [tractorId], references: [id])

  trailerId String?
  trailer   Trailer? @relation(fields: [trailerId], references: [id])

  revenueIncome Float? // ← مهم جداً علشان ما يقعش لو جاله ""
  costDriver    Float? @default(0)
  costTruck     Float? @default(0)
  costDiesel    Float? @default(0)

  driverIds Json     @default("[]")
  notes     String   @default("")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([date])
  @@index([tractorId])
  @@index([trailerId])
}
